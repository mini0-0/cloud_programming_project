{% extends "movie_base/base_with_navbar.html" %}

{% load static %}
{% load crispy_forms_tags %}

{% block title %} {{ review.title }} | Movie {% endblock title %}

{# <div class="content">#}
{#       {% for c in categories %}#}
{#            <a href={{ c.get_absolute_url }}>{{ c.name }} ({{ c.review_set.count }}) </a>#}
{#        {% endfor %}#}
{#            <a href="category/no-category">미분류({{ no_category_count }})</a>#}
{##}
        {% if category %}  Movie in category '{{ category }}' {% endif %}
        {% if tag %}  Movie with tag '{{ tag }}' {% endif %}
{#    </div>#}

{% block content %}
<main class="site-body">
  <article class="review-detail max-content-width">
    <div class="review-info">
      <div class="restaurant-name">
          <h2>영화 제목 <span class="cp-chip green"> {{ review.movie_name }}</span></h2>
      </div>
      <h1 class="title">제목: {{ review.title }}</h1>
      <div class="author">
        <a class="review-author" href="{% url 'profile' review.author.id %}">
          <div class="cp-avatar" style="background-image: url('{{ review.author.profile_pic.url }}')"></div>
          <span>{{ review.atuhor.nickname }}</span>
        </a>
      </div>
      <date class="date">{{ review.dt_created|date:"Y년 n월 j일"}}</date>
      <div class="review-rating">
        <span class="cp-stars">
          평점 {{ review.rating }}
        </span>
      </div>
    </div>
    <hr/>
    <div class="content">
      <img src="{{ review.image1.url }}">
      {% if review.image2 %}
        <img src="{{ review.image2.url }}">
      {% endif %}
      {% if review.image3 %}
        <img src="{{ review.image3.url }}">
      {% endif %}

        <h3> 감상평 </h3>
      <p class="content">{{ review.content|linebreaksbr }}</p>


    <hr>
        {% if review.tags.exists %}
            <br />
            <i class = "fas fa-tags"></i>
            {% for tag in review.tags.iterator %}
                <a href = {{ tag.get_absolute_url }}> #{{ tag }}</a>
            {% endfor %}

            <br />    <br />
        {% endif %}
        <hr>

       <h3>장르</h3>
        {{ review.category }}
        <hr>
    </div>


      <div>
          <h4>댓글 작성</h4>
          <form method="post" action="{{ review.get_absolute_url }}comment/">
              {% csrf_token %}
              {{ comment_form | crispy }}
              <button type="submit" class="btn btn-primary">제출</button>
          </form>
      </div>

        <hr>
    <div>

    {% if review.comment_set.exists %}
        {% for comment in review.comment_set.iterator %}

          <div class="media-body" id = "comment-{{ comment.pk }}">
            <h5 class="mt-0">
                작성자: {{ comment.author }} &nbsp;&nbsp; 작성일 ({{ comment.dt_created }})
            </h5>

              <p>{{ comment.content }}</p>
          </div>

    </div>

            <div>
            {% if user == comment.author %}
             <form method="post" action="{{ review.get_absolute_url }}comment/{{ comment.pk }}/delete/">
                 {% csrf_token %}
                 <button type="submit">삭제</button>
             </form>

            <form method="post" action="{{ review.get_absolute_url }}comment/{{ comment.pk }}/update/">
                    {% csrf_token %}
                   <button type="submit">수정</button>
             </form>

            {% endif %}
            </div>
        {% endfor %}
      {% endif %}
    </div>





    <div class="footer">
      <a class="back-link" href="{% url 'index' %}">&lt; 목록으로</a>
      {% if review.author == user %}
        <div class="buttons">
          <a class="cp-button warn" href="{% url 'review-delete' review.id %}">삭제</a>
          <a class="cp-button secondary" href="{% url 'review-update' review.id %}">수정</a>
        </div>
      {% endif %}
    </div>
  </article>
</main>
{% endblock content %}
